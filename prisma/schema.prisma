generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int             @id @default(autoincrement())
  email     String          @unique
  password  String
  fullName  String
  role      Role
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  questions Question[]
  papers    QuestionPaper[]
}

model Student {
  id                      Int            @id @default(autoincrement())
  studentId               String?        @unique
  password                String
  fullName                String
  fatherName              String
  motherName              String
  dateOfBirth             DateTime       @db.Date
  gender                  String
  email                   String         @unique
  mobileNumber            String
  alternativeMobileNumber String?
  stream                  Stream
  qualifyingExam          QualifyingExam
  yearOfPassing           Int
  medium                  String?
  placeOfStudy            String?
  marks                   String?
  collegeName             String?
  collegeAddress          String?
  category                Category
  minorityStatus          String
  address                 String
  city                    String
  state                   String
  pincode                 String
  photo                   String?
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  refreshToken            String?
  isAttemptingExam        Boolean        @default(false)
  isSafe                  Boolean        @default(false)
  examAttempts            ExamAttempt[]
}

model Question {
  id               Int             @id @default(autoincrement())
  text             String
  options          String[]
  correctAnswer    String
  subject          Subject
  difficulty       Difficulty
  uploadedById     Int
  createdAt        DateTime        @default(now())
  optionAImageUrl  String?
  optionBImageUrl  String?
  optionCImageUrl  String?
  optionDImageUrl  String?
  questionImageUrl String?
  topic            String
  paperQuestions   PaperQuestion[]
  uploadedBy       User            @relation(fields: [uploadedById], references: [id])
}

model QuestionPaper {
  id             Int             @id @default(autoincrement())
  title          String
  accessCode     String          @unique
  durationHours  Int             @default(3)
  totalMarks     Int             @default(160)
  isActive       Boolean         @default(true)
  createdById    Int
  createdAt      DateTime        @default(now())
  startTime      DateTime?
  examAttempts   ExamAttempt[]
  paperQuestions PaperQuestion[]
  createdBy      User            @relation(fields: [createdById], references: [id])
}

model PaperQuestion {
  paperId    Int
  questionId Int
  paper      QuestionPaper @relation(fields: [paperId], references: [id])
  question   Question      @relation(fields: [questionId], references: [id])

  @@id([paperId, questionId])
}

model ExamAttempt {
  id          Int           @id @default(autoincrement())
  studentId   Int
  paperId     Int
  startTime   DateTime      @default(now())
  endTime     DateTime?
  answers     Json?
  isCompleted Boolean       @default(false)
  score       Int           @default(0)
  paper       QuestionPaper @relation(fields: [paperId], references: [id])
  student     Student       @relation(fields: [studentId], references: [id])
  result      Result?
}

model Result {
  id           Int         @id @default(autoincrement())
  attemptId    Int         @unique
  totalScore   Int
  analysisJson Json?
  createdAt    DateTime    @default(now())
  examAttempt  ExamAttempt @relation(fields: [attemptId], references: [id])
}

enum Role {
  STUDENT
  TEACHER
  ADMIN
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum Subject {
  PHYSICS
  CHEMISTRY
  MATHEMATICS
}

enum Stream {
  ENGINEERING
  PHARMACY
}

enum QualifyingExam {
  INTERMEDIATE_REGULAR
  INTERMEDIATE_VOCATIONAL
  BRIDGE_COURSE
}

enum Category {
  OC
  BC_A
  BC_B
  BC_C
  BC_D
  BC_E
  SC
  ST
  EWS
}
